+
Вопросы:
### - **Как изучать логи на маршрутизаторе**
### - **Как поднять IPSec/SSL VPN для удаленки**
### - **Как настроить NAC**
### - **Как настроить мониторинг через SNMP**


# **Квиз**

> > # **# Какие уровни сетевой архитектуры знаете?**
> > 	# **# Ответ: Access layer(Уровень доступа), Distribution layer(Уровень распределения), Core layer(Уровень ядра)**
> 
> 	# **Что такое LAG-протоколы**
> 		# Ответ: **Это протокол логического объединения физических линков** 





Модель OSI (**O**pen **S**ystems **I**nterconnection) — это стандартизированная модель, которую мы используем для демонстрации теории, лежащей в основе компьютерных сетей. В на практике это на самом деле более компактная модель TCP/IP, на которой базируются реальные сети; однако модель OSI во многих отношениях легче получить первоначальное понимание.

|  7  |  Прикладной<br>(Application)  |        Интерфейс для приложения и пользователей, обеспечивает доступ к сетевым службам и ресурсам        |               HTTP, HTTPS, FTP, SMTP, DNS                |
| :-: | :---------------------------: | :------------------------------------------------------------------------------------------------------: | :------------------------------------------------------: |
|  6  | Представления<br>Presentation | Преобразование данных: кодирование, сжатие, шифрование, и декодирование для совместимости и безопасности |              **SSL/TLS, ASCII, GIF, JPEG**               |
|  5  |    Сеансовый <br>(Session)    |     Управление сеансами связи: установление, поддержание и завершение соединений между приложениями.     |                **Х.225, ISO 8327, SMPP**                 |
|  4  |  Транспортный<br>(Transport)  |               Надежная доставка данных, управление потоками, сегментация и контроль ошибок               |                       **TCP, UDP**                       |
|  3  |     Сетевой<br>(Network)      |         Маршрутизация пакетов, логическая адресация(IP-адреса, управление трафиком между сетями          |               **IP, ICMP, ARP, RIP, OSPF**               |
|  2  |   Канальный<br>(Data Link)    |  Надежная передача фреймов по физическому каналу, обнаружение и исправление ошибок, управление доступом  |        **Ehternet, PPP, MAC-адрес, коммутаторы**         |
|  1  |   Физический<br>(Physical)    |        Передача битов по физическим средствам: электрические, оптические сигналы, кабели, разъемы        | **Кабели(Витая пара, оптоволокно), разъемы RJ45, Wi-FI** |


### Инструменты для практики:
	Cisko Packet Tracer
	GNS3
	EVE-NG



/30 - 255.255.255.252
/24 - 255.255.255.0
/8 - 255.0.0.0

# Понятия протоколов


### **HTTP/HTTPS**


**HHTP**  -  **HyperText Transfer Protocol** (port 80, данные передаются в открытом виде)
Риски - перехват трафика, подмена данных, фишинг(поддельные сайты)
```bash
curl http://example.com/login # Логин/пароль видны в сети!
```
**HHTPS** - защищенная версия HHTP с шифрованием, использует TLS/SSL для шифрование, порт 443
```bash
curl https://example.com/login # Данные зашифрованы
```

| Атака            | HTTP | HTTPS | Защита                   |
| ---------------- | ---- | ----- | ------------------------ |
| **MITM**         | Да   | Нет   | Сертификаты, HSTS        |
| **SSL Strip**    | —    | Да    | HSTS, Preload Lists      |
| **BEAST/POODLE** | —    | Да    | Отключить SSLv3, TLS 1.0 |
*HTTPS уязвим к MITM только при поддельном сертификате или ошибках в реализации.

**Инструменты**: для проверки безопасности HHTPS
- [SSL Labs Test](https://www.ssllabs.com/ssltest/) — анализ конфигурации TLS.
- 1. **Ключевые параметры**:
    - TLS 1.2/1.3 (не 1.0 или 1.1!).
    - Алгоритмы: AES-GCM, ECDHE.
    - Действующий сертификат (не самоподписанный).

_____________________________________________________________________________________________________ 


##### **DNS( Domain Name System)** - **Назначение**: Преобразует доменные имена (например, `google.com`) в IP-адреса (`142.250.185.174`).
![[Pasted image 20251204234258.png]]

##### **Угрозы и защита**

| Атака                   | Описание                                              | Защита                       |
| ----------------------- | ----------------------------------------------------- | ---------------------------- |
| **DNS Spoofing**        | Подмена DNS-записи (перенаправление на фейковый сайт) | DNSSEC, DNS-over-HTTPS (DoH) |
| **DNS Cache Poisoning** | Заражение кэша DNS-сервера ложными записями           | Рандомизация ID запросов     |
| **DDoS на DNS**         | Перегрузка DNS-сервера запросами                      | Anycast, Rate Limiting       |

### **Уязвимость DNS и атаки**

А. Подмена DNS (DNS Spoofing/Poisoning) - злоумышленник подменяет DNS - запись, перенаправляя жертву на фальшивый сайт
	Пример: Пользователь вводит bank.com, но попадает на IP-адрес злоумышленника.
	Защита: DNSSEC (цифровая подпись DNS - записей), использование DNS-over-HTTPS(DoH) или DNS-over-TLS(DoT)



> Непонятные термины: 
> 1)  **DNS over HTTPS (DoH)** - Механизм шифрования DNS-запросов с помощью **HTTPS** (порт 443).  
> 								Запросы маскируются под обычный веб-трафик, что затрудняет их блокировку.
```bash
# Настройка в Firefox:
about:config → network.trr.mode → 2 (DoH-only)
```
> 
> 2)  **DNS over TLS (DoT)**  - Шифрование DNS-запросов с помощью **TLS** (порт 853).  
> 							Отдельный протокол, не маскирующийся под другой трафик.
	
```bash
# Настройка в Android:
Настройки → Сеть → Частный DNS → dns.google
```

### Технологии защиты DNS

| Технология                      | Описание                                              | Пример                   |
| ------------------------------- | ----------------------------------------------------- | ------------------------ |
| **DNSSEC**                      | Цифровая подпись DNS-записей для проверки подлинности | `dig +dnssec google.com` |
| **DoH/DoT**                     | Шифрование DNS-трафика                                | Cloudflare (`1.1.1.1`)   |
| **Response Policy Zones (RPZ)** | Блокировка вредоносных доменов                        | Блокировка `malware.com` |
| **DNS Sinkholing**              | Перенаправление вредоносных запросов на "пустышку"    | Блокировка ботнетов      |



_____________________________________________________________________________________________________ 


## **==ARP (Address Resolution Protocol)== - это протокол, который связывает IP-адреса с MAC-адресами в локальной сети(LAN). Хотя он критически важен для работы сетей, его уязвимости активно используются в атаках.**



#### **Уязвимости ARP и атаки**

1) ARP Spoofing / ARP Poisoning
		Суть: Злоумышленник подменяет ARP - таблицы, выдавая себя за другое устройство
		Как работает: 
			Атакующий (192.168.1.99) отправляет ложные ARP-ответы
				"Я - 192.168.1.3. мой MAC - (фальшивый)"
			Теперь трафик для 192.168.1.3 идет к атакующему - MITM (Man-in-the-Middle)

	Последствия 
		- перехват паролей, cookies, данных
		- подмена DNS (например, перенаправление на фишинговый сайт)
		- Атаки типа SSL Stripping (понижение HTTPS до HHTP)

2) ARP Flooding (MAC Flooding)
		Суть: Переполнение ARP-таблицы коммутатора фальшивыми MAC - адресами
		Как работает:
			- Атакующий генерирует тысячи ложных ARP - ответов
			- Коммутатор перестает фильтровать трафик - переходит в режим hub (транслирует всем)
	
	Последствие:
		- Снижение производительности сети
		- Возможность сниффинга трафика (как в старых hub - сетях)

### **Инструменты для тестирования ARP-уязвимостей**

| Инструмент            | Назначение                      |
| --------------------- | ------------------------------- |
| **Ettercap**          | MITM, ARP-спуфинг, сниффинг     |
| **Cain & Abel**       | ARP Poisoning, перехват паролей |
| **arpspoof** (dsniff) | Генерация ложных ARP-ответов    |
| **Wireshark**         | Анализ ARP-трафика              |
| **Netdiscover**       | Сканирование сети через ARP     |

%% Непонятные термины: %%
**MITM (Man-in-the-Middle, "Человек посередине")** — это тип кибератаки, при которой злоумышленник **тайно перехватывает и изменяет обмен данными** между двумя сторонами (например, между пользователем и сайтом), оставаясь незамеченным.


---


# **Сетевой инженер**

| Префикс | Маска           | Кол-во хостов | Диапазон адресов          |
| ------- | --------------- | ------------- | ------------------------- |
| **/24** | 255.255.255.0   | 254           | 192.168.1.0-192.168.1.255 |
| **/25** | 255.255.255.128 | 126           | 192.168.1.0-192.168.1.127 |
| **/26** | 255.255.255.192 | 62            | 192.168.1.0-192.168.1.63  |
| **/27** | 255.255.255.224 | 30            | 192.168.1.0-192.168.1.31  |
| **/28** | 255.255.255.240 | 14            | 192.168.1.0-192.168.1.15  |

# **Канальный уровень
**
	Передача сообщений по каналу связи
		Определение начало/конца  сообщения в потоке бит

# *Виды связей* 

1) Simplex - односторонняя связь 
		Пример:  Теле- и радиовещание, передача сигнала от спутников GPS
2) Half-duplex - двусторонняя связь, но в один момент времени может передавать только одно устройство 
		Пример: общение по рации, когда можно либо слушать канал, либо, нажав кнопку, передавать в него.
3)  Full - duplex или просто duplex - двусторонняя передача, оба устройства могут одновременно вести передачу
		Пример: разговор по телефону

# *Методы передачи данных* 

1) Unicast - передача данных единственному адресату. 
2) Broadcast - широковещательная передача данных всем устройствам (FF-FF-FF-FF-FF-FF-FF)
3) Multicast - передача данных группе устройств (первый значащий бит равен 1)

Термины:

**LAN (ЛВС, Local Area Network)** — локальные сети, имеющие замкнутую инфраструктуру до выхода на поставщиков услуг. Термин LAN может описывать и маленькую домашнюю или офисную сеть, и сеть уровня большого предприятия, занимающего несколько сотен гектаров.

**CAN (Campus Area Network)** — кампусная сеть, объединяет локальные сети близко расположенных зданий. Например, в университете несколько кампусов объединены одной сетью. Также может быть завод или гидроэлектростанция, там много разных зданий-цехов, и всё это является отдельными сетями, но объединяется одной кампусной сетью.

**MAN (Metropolitan Area Network)** — городские сети между учреждениями в пределах одного или нескольких городов, связывающие много локальных вычислительных сетей. Можно сказать, большой CAN. Например, у университета много филиалов по городу, краю, области, и всё это объединяется сетью MAN.

**WAN (Wide Area Network)** — глобальная сеть, покрывающая большие географические регионы и включающая в себя как локальные сети, так и прочие телекоммуникационные сети и устройства. Самая большая единица. Может распространяться и по всей стране.

# *Виды топологии*

Сетевая топология - это структура графа, на вершинах которого находятся конечные узлы сети (компьютер/телефоны/принтеры) и  сетевое оборудование (коммутаторы. роутеры), а ребра - физические линии связи между собой

Сетевые топологии могут быть:
1) физическими - определяет как физически соединены устройства в сети
2) логическими - определяет направление потоков данных между узлами сети и способы передачи данных

- Топология "Общая шина"
- Топология "Звезда"
- Кольцевая топология
- Полносвязная топология
- Ячеистая топология
- Топология "Иерархическая звезда" (Дерево)
- Смешанная топология


# VLAN(Virtual LAN)

- технология, позволяющая выделять выбранные узлы в отдельную сеть на канальном уровне(втором уровне OSI)
  Коммутатор добавляет теги к сетевым фреймам и таким образом разделяют узлы сети. Поэтому устройство становиться недоступны для сетевого взаимодействия, несмотря на то, что они подключены к одной и той же физической сети

 Протокол тегирование -  802.1Q
 Пояснение: в каждом коммутаторе содержится несколько портов, каждый порт может быть в своем VLAN, для того что не кидать кабель к каждому tranck  порту, есть  протокол тегирование 802.1Q, который записывает номер VLAN 

На одном коммутаторе можно создавать около 4094 VLAN

#### Access(edge) ports - интерфейсы, к которым обычно подключаются конечные пользователи (ПК. другое клиентское оборудование). Access-порты ассоциируются с конкретной VLAN. В таблице коммутации однозначное сопостовление порта с VLAN. При передаче кадров инкапсуляция dog1.q в access-порт не происходит 

#### Trunk ports - интерфейсы, к которым подключен коммутатор. Используются для объединение широковещательных доменов одной Vlan, созданной на разных коммутаторах. При передаче кадров происходит  инкапсуляция dot1.q. Кадры помечаются тегами в соответствии с тем, в какой Vlan они были получены 

``
```bash
Switch>enable  
Switch#confi terminal  
Switch(config)#vlan 10  
Switch(config-vlan)#name left  
Switch(config-vlan)#exit  
Switch(config)#vlan 20  
Switch(config-vlan)#name right  
Switch(config-vlan)#exit
Switch(config)#interface fastEthernet 0/1  
Switch(config-if)#switchport mode access  
Switch(config-if)#switchport access vlan 10  
Switch(config-if)#exit
```


  


---


# *Сетевой уровень* - третий уровень, отвечает за доставку пакета адресату 

IPv4 - состоит из  4 октета
0-255.0-255.0-255.0-255
1 октет - адрес сети, а остальное номер хоста

##### Классовая адресация:
1) Class A
		net.host.host.host/8  
		255.0.0.0 - можно записать  /8 (маска подсети)
		net.0.0.0.0 - это адрес сети (net addr)
		net.255.255.255 - это broadcast адрес
		0-127 бита
2) Class B
		net.net.host.host/16
		255.255.0.0 - можно записать  /16 (маска подсети)
		net.net.0.0 - это адрес сети (net addr)
		net.net.255.255 - это broadcast адрес
		128-191
3) Class C
		net.net.net.host/24
		255.255.255.0 - можно записать  /24 (маска подсети)
		net.net.net.0 - это адрес сети (net addr)
		net.net.net.255 - это broadcast адрес
		192 -224
4) Class D
		224-239

| Сеть          | Маска           | Broadcast-адрес  |
| ------------- | --------------- | ---------------- |
| `192.168.1.0` | `255.255.255.0` | `192.168.1.255`  |
| `10.0.0.0`    | `255.0.0.0`     | `10.255.255.255` |
| `172.16.0.0`  | `255.255.0.0`   | `172.16.255.255` |

Таблица mac - адресов

 arp -a

```

# **Настройка коммутаторов, маршрутизаторов через CLI**

Установка IP 
```bash
r1(config-if)# ip addr 192.168.0.1 255.255.255.0
```
Таблица ARP
```bash
sh ip arp
```
Просмотр всех IP интерфейсов
```bush
sh ip int brief
```
Вывод всех построенных маршрутов 
```bush
do sh run | i route
```
#####

****
#### *Маршрутизация* 

Маршрутизация выполняет задачи:
1) Routing - маршрутизация - поиск маршрута для IP - пакета
2) Forwarding - продвижение - пересылка пакета в нужный шлюз/сетевой интерфейс

Маршрутизация бывает:
1) Статическая (таблицы настраиваются на каждом маршрутизаторе)
2) Динамическая (маршрутизаторы сами обмениваются таблицами)

##### **Важно**: Маршрутизация выполняется на каждом компьютере, даже на обычной рабочей станции имеется таблица маршрутизации, как правило из одно (устройство) или двух (устройств и маршрут по умолчанию)

![[Pasted image 20250722185801.png]]



==**Дефолтный маршрут** (англ. _default route_)== — это маршрут в компьютерных сетях, который используется, когда нет других, более конкретных маршрутов для передачи данных к определённому IP-адресу.

```bash
route print | find "0.0.0.0"
```


==**Loopback** (англ. _loopback interface_, петлевой интерфейс)== — это виртуальный сетевой интерфейс, который позволяет компьютеру обращаться к самому себе через сетевой стек, даже без физического подключения к сети.

- **IP-адрес:**
    - В **IPv4** обычно используется `127.0.0.1` (стандартный адрес локальной петли).
    - В **IPv6** — `::1`.
    - Весь диапазон `127.0.0.0/8` (от `127.0.0.1` до `127.255.255.254`) зарезервирован для loopback.
        
- **Назначение:**
    - Тестирование сетевых приложений без реального сетевого подключения.
    - Проверка работоспособности сетевого стека ОС.
    - Обеспечение связи между сервисами внутри одного компьютера (например, веб-сервер на localhost).


**==Broadcast==** (широковещательный адрес) — это специальный IP-адрес, используемый для отправки данных **всем устройствам** в локальной сети (LAN) одновременно, а не конкретному получателю (unicast) или группе (multicast).
##### Как работает broadcast?**
1. **Отправка пакета** на broadcast-адрес.
2. **Все устройства** в подсети получают этот пакет.
3. **Устройства проверяют**, нужен ли им этот пакет (например, ARP-запросы, DHCP-запросы). 



### Настройка динамической маршрутизации 

Команды:

Проверка настройка динамической маршрутизации
```
r2#sh ip protocols
```

Настройка динамической маршрутизации с помощью протокола RIPv2
```
r2(config)#router rip
```


## Настройка DHCP сервера

Сброс настроен на ПК от DHCP
```bush
ipconfig /release
```


Обратно получить настройки, получение от DHCP сервера настройки
```bush
ipconfig /renew
```

## Настройка DHCP сервера на маршрутизаторе

Отступ первый 100 IP адресов 
Первый клиент получит первый IP 10.0.0.100
```bush
r1(config)#ip dhcp excluded-address 10.0.0.0 10.0.0.99
```

Создание пула
```bush
r1(config)#ip dhcp pool lan
```

Указываем default ip маршрутизатора
```
r3(dhcp-config)#default-router 10.0.0.1
```

Указываем DNS сервер
```
r3(dhcp-config)# dns-server 8.8.8.8
```

Указываем обязательно сеть
```
r3(dhcp-config)#network 10.0.0.0 255.0.0.0
```

Просмотр клиентов сервера
```bush
r1#sh ip dh binding
```

#### Динамическая(DHCP) маршрутизация 

Протоколы делятся на внутренние и внешние шлюзы - 
Протокол RIP 


---


# Транспортный уровень - его задача обеспечить надежную или ненадежную (в зависимости от протокола) передачу данных между двумя приложениями, работающими на разных компьютерах. 

User Datagram Protocol (UDP) - протокол передачи дейтаграмм пользователя

UDP - делятся на две стороны, по второй стороне он принимает пакеты даже не проверив, были ли потеряны какие либо пакеты либо нет
1) без установления соединения 
2) НЕ надежная передача
3) используется служебными протоколами в локальных сетях RIP, SNMP. DHCP, TFTP


TCP
- стороны договариваются о соединение
- надежная передача
- управлением потока

Установка соединения - это тройное рукопожатие
1) SYN (seq=a) - первое устройство просит соединение со вторым 
2) SYN(seq=b, ack=a+1) - второе дает разрешение
3) SYN(seq=a+1, ack=b+1) - окей, давай начинать, говорит первый
SYN - Синхронизировать
ACK - Подтверждение


---


## **NAT** 

(Network Address Translation) — это технология, которая позволяет преобразовывать IP-адреса в сетях. Проще говоря, это «переводчик» между вашей локальной сетью и интернетом.

Для чего нужен NAT?
- Экономия IPv4-адресов: Не нужно выдавать уникальный внешний IP каждому устройству в сети.
- Безопасность: устройства из интернета не могут напрямую подключиться к вашим устройствам (если не настроен проброс портов).
- Гибкость: можно легко менять устройства внутри сети без смены внешнего IP.

Типы NAT 
Статический, Динамический, Перегруженный


Назначается на интерфейс, который смотрит во внутреннюю сеть (например, в вашу локальную сеть офиса или дома).

```bash
ip nat inside 
```

Назначается на интерфейс, который смотрит во внешнюю сеть (например, в интернет, towards your ISP)

```bash
ip nat outside
```


#### Шаг 1: Помечаем интерфейсы как inside и outside

Заходим в режим настройки внутреннего интерфейса

```
Router(config)# interface FastEthernet0/0
Router(config-if)# ip nat inside  ! Этот интерфейс подключен к ЛОКАЛЬНОЙ сети
```

#### Шаг 2: Создаем Access Control List (ACL)

ACL нужен, чтобы определить ("отсеять"), трафик с каких внутренних IP-адресов нужно трансллировать. Обычно разрешают всю внутреннюю подсеть.

```
! Создаем ACL с номером 1 (можно использовать именованный ACL)
Router(config)# access-list 1 permit 192.168.1.0 0.0.0.255
! Эта команда разрешает трансляцию для всех адресов в сети 192.168.1.0/24
```

#### Шаг 3: Настраиваем тип трансляции (PAT или Static)

**Вариант А: PAT (Overloading) — самый частый случай**  
Это когда все внутренние устройства "выходят" в интернет через один единственный публичный IP-адрес внешнего интерфейса. Маршрутизатор использует разные порты, чтобы отличать соединения друг от друга.

```
Router(config)# ip nat inside source list 1 interface FastEthernet0/1 overload
```
- `list 1` — ссылаемся на ACL №1, который мы создали.
- `interface FastEthernet0/1` — использовать IP-адрес этого внешнего интерфейса для трансляции.
- `overload` — ключевое слово, которое включает PAT (NAT с перегрузкой портов).


**Вариант Б: Статический NAT (для серверов)**  
Используется, если у вас во внутренней сети есть сервер (например, веб-сервер на `192.168.1.10`), которому нужно выдать постоянный публичный IP-адрес.
```
Эта команда "пробрасывает" порт 80 внешнего IP-адреса на порт 80 внутреннего сервера.

Router(config)# ip nat inside source static tcp 192.168.1.10 80 203.0.113.1 80
```


---



### Протокол STP (Spanning Tree Protocol)

STP - сетевой протокол (или семейство сетевых протоколов) предназначен для автоматического удаления циклов (петель, коммутации) из топологии сети на канальном уровне в Ethernet - сетях.  

Команда для быстрого ping, при подключении порт поднимается моментально

```bush
sw1(config-if)#spanning-tree portfast
```

---

Протокол BGP 

BGP -  это метод маршрутизации, который позволяет интернету функционировать, без него мы бы не смогли делать поиск в Google и многое другое 

Существует два типа BGP

1) IBGP - для внутренней маршрутизации (internal)
2) EBGP - для внешней маршрутизации (external) протокол внешнего шлюза
   





---

# **IPv6 - интернет протокол** - КВИЗ

#### 1) Какова длина адреса IPv6 и чем она отличается от адреса IPv4?
	Ответ: IPv6 использует 128-битные адреса, что позволяет создать огромное количество уникальных адресов по сравнению с 32-битными адресами IPv4, что решает проблему исчерпания адресов.
	
#### 2) Каковы основные типы адресов в IPv6?
   Ответ: IPv6 использует три основных типа адресов для различных видов коммуникаций: **Unicast** для связи с одним интерфейсом, Multicast для отправки пакетов группе интерфейсов и Anycast для отправки пакета ближайшему интерфейсу из группы.
##### * Unicast (Одноадресная передача)**

- **Один отправитель → один получатель**
- **Пример:** `2001:db8::1` → `2001:db8::2`
- **Типы unicast адресов:**
    - **Global Unicast** (публичные, глобальные) — `2000::/3`
    - **Unique Local** (аналог private IPv4) — `fc00::/7`
    - **Link-Local** (только в пределах сегмента) — `fe80::/10`
##### Multicast (Многоадресная передача)**

- **Один отправитель → много получателей** (определённая группа)
- **Пример:** `ff02::1` — все узлы в сегменте сети
- **Всегда начинаются с `ff00::/8`**
##### Anycast (Эйкаст / Произвольная рассылка)**

- **Один отправитель → ближайший из группы получателей**
- **Использует тот же формат**, что и unicast
- **Пример:** DNS-серверы с одинаковым адресом в разных дата-центрах


#### 3) В протоколе IPv4 широковещательная передача (вещание), которая отсутствует в IPv6. Вместо широковещательной передачи в IPv6 используется многоадресная передача (многоадресная рассылка).
Ответ: Многоадресная передача обеспечивает одновременную доставку данных стандартными получателями с меньшими требованиями к пропускной способности сети. В режиме отправки рассылки (anycast) пакеты данных отправляются от одного отправителя в окрестностях из нескольких получателей с тем же адресом производятся рассылки.


#### 4) IPv6 включает обязательную поддержку IPsec, что обеспечивает шифрование и аутентификацию данных по умолчанию

#### 5) Как осуществляется преобразование между IPv4 и IPv6?
Ответ: NAT64 (Network Address Translation for IPv6) позволяет преобразовывать пакеты между протоколами IPv4 и IPv6, обеспечивая возможность взаимодействия между устройствами, работающими на разных протоколах

#### 6) Чем отличается маршрутизация в IPv6 от маршрутизации в IPv4?
Ответ:  IPv6 предлагает более эффективные механизмы маршрутизации благодаря упрощению заголовков и поддержке протоколов, таких как OSPF и BGP.

#### 7) Какие дополнительные функции предоставляет протокол IPv6 по сравнению с предыдущими версиями?
Ответ: IPv6 использует механизм Stateless Address Autoconfiguration (SLAAC), который позволяет устройствам автоматически настраивать свои адреса, упрощая процесс подключения к сети и снижая зависимость от DHCP.

#### 8) Какова роль протокола ICMPv6 в сети на основе IPv6?
Ответ: ICMPv6 выполняет важные функции, такие как обнаружение маршрутизаторов и разрешение адресов, что позволяет устройствам автоматически настраивать свои адреса и взаимодействовать друг с другом в сети.

9) Какой из этих префиксов содержатся в адресе: 2001:DB8:2314:5678::9ABC:DEF0?
	Ответ: 
	2001:DB8:2314:5678::9AB8:0/109
Правильный ответ
Верно. Каждый символ в IPv6-адресе - это 4 бита, а каждый октет - это 16 бит.  
Поэтому 109 бит является 1-м битом в 7-ом октете 4-ого символа- **С** (**1**100) и **8** (**1**000) соответственно.
Все 109 бита в нашем адресе и префиксе совпадают.  
**2001:0DB8:2314:5678:0000:0000:9AB_C_**:DEF0  
**2001:0DB8:2314:5678:0000:0000:9AB_8_**:0000/109


   

---

# Отказоустойчивость  сети 

####  Действия нарушителя: атаки на сервисы, НСД с целью уничтожения данных

1. **НСД** (несанкционированный доступ к устройствам).
    
2. **DoS-атаки и DDoS-атаки** (отказ в обслуживании).  
    DoS-атаки — попытка перегрузить ресурсы системы или сервиса, чтобы он стал недоступным для легитимных пользователей. Может достигаться отправкой большого количества запросов на обработку данных или использования других методов, которые приводят к истощению ресурсов системы.  
    DDoS-атаки (распределённые отказы в обслуживании) — разновидность DoS-атак, при которых используется ботнет — сеть компрометированных компьютеров, чтобы одновременно направить огромное количество запросов на целевую систему или сервис. Это делает её недоступной для легитимного использования.
    
3. **IP-spoofing** .  
    IP-spoofing — это техника, при которой нарушитель изменяет свой IP-адрес, чтобы выдать себя за другое устройство или пользователя. Используется для обхода механизмов аутентификации и авторизации, а также для сокрытия источника атаки.
    
4. **ARP-spoofing** .  
    ARP-spoofing — это метод, при котором нарушитель отправляет ложные ARP-пакеты в сеть, чтобы подменить MAC-адреса устройств и перехватывать или изменять сетевой трафик. Это позволяет ему прослушивать или модифицировать данные, передаваемые между устройствами.
    
5. **Man in the middle**.  
    Man in the middle (MITM) — это атака, при которой нарушитель вставляется между двумя коммуницирующими сторонами и перехватывает или изменяет передаваемые данные. Он может прослушивать конфиденциальную информацию, вносить изменения в сообщения или даже создавать ложные сообщения, чтобы запутать стороны.



#### **Петля коммутации (bridging loop, switching loop)** — состояние в сети, при котором происходит бесконечная пересылка пакетов между коммутаторами, подключёнными в один и тот же сегмент сети.

Чтобы решить проблему с петлёй коммутации, нужно использовать протокол **STP (spanning tree protocol)**. STP заблокирует один из линков, и будет по факту один рабочий линк. Как только с этим рабочим линком что-то произойдёт, STP автоматически разблокирует второй линк, и связь сохранится.  
Основной недостаток протокола STP — в один момент времени рабочим линком является только один незаблокированный линк.

На правой схеме — два маршрутизатора Router0 и Router1 подключены двумя физическими линками, которые объединены в один логический линк благодаря технологии агрегации.


# 5. Основные технологии для обеспечения отказоустойчивости:
   
- резервирование физических линков;
- резервирование на уровне L2 — использование протоколов STP, методов агрегации сетевых интерфейсов;
- резервирование на уровне L3 — протоколы First-Hop Redundancy; **VRRP  **(Virtual Router Redundancy Protocol)****
- резервирование на уровне L4-L7 — создание кластерных структур.

# Агрегация Cisco


> - **STP** — это **регулировщик на перекрёстке**, который запрещает движение по «лишним» дорогам, чтобы не было аварий (петель).
>     
> - **LACP** — это **расширение дороги из двух полос в одну широкую**, чтобы увеличить пропускную способность и сделать её отказоустойчивой.


Терминология, используется компанией
1) EtherChannel - технология агрегирования каналов
2) Port-channel - логический интерфейс, который объединяет физический интефейсы
3) Channel-group - команда, которая указывает, какому логическому интерфейсу принадлежит физический интерфейс и какой режим используется для агрегирования 

## Методы агрегации

Исходя из вышесказанного, можно определить, что агрегация интерфейсов работает на канальном уровне модели OSI

##### Работает либо с использованием протоколов, либо без протоколов:
##### 1) LACP (Link Aggregation Control Protocol) - стандартный протокол 
##### 2) PAgP (Port Aggregation Protocol) - проприетарный протокол Cisco
##### 3) статическое агрегирование

Настройка статической агрегации
Первая команда, которая нужна - команда channel-group:

```bush
swich(config-if)# channel-group <channel-group-number> mode <<auto [non-silent] | desirable [non-silent] | on> | active | passive>>
```

Параметры команды:
1) active - включить LACP
2) passive - включить LACP, только если придет сообщение LACP
3) desirable - включить PAgP
4) auto - включить PAgP, только если придет сообщение PAgP
5) on - включить статическую агрегацию

### настройка статической агрегации L2


Команды просмотра информации:
1) show etherchannel summary - просмотр общей информации о EtherChannel
2) show etherchannel port-channel - просмотр информации о EtherChannel по порт-каналу 
3) show etherchannel detail  - подробная информация  
Команды настройки: режим conf t       
4) interface range f0/1-4 - выбор группы интерфейсов FastEthernet
5) shutdown - отключение все выбранных портов 
6) channel-group1 mode on - создание группы для агрегации с технологией EtherChannel
7) no shutdown - включить все выбранные порты

>  ==**настройка агрегации на основе протокола LACP тоже самое, только меняется слова on на active**==


Удаление port channel на интерфейсах 
```bush
Switch(config)#no interface port-channel 1
```

Скинуть все на default
```bush
Switch(config)#default interface range fa0/1-4
```

# Агрегация на основе LACP (PAgP делает принципе тоже самое) 802.3ad

Рассмотрим работу агрегации на основе EtherChannel на оборудовании Cisco с использованием протоколов LACP, описание в 802.3ad (IEEE)

1) Преимущество агрегации на основе LACP
		согласование настроек с удаленной стороной позволяет избежать ошибок и петель в сети 
		поддержка standby-интерфейсов
2) Недостаток агрегации на основе LACP
		вносит дополнительную задержку при  поднятии агрегированного канала или изменении его настроек


# Балансировка нагрузки

Балансировка нагрузки - метод распределения трафика между несколькими элементами в сети

1) Серверы
2) Приложения
3) Сетевое оборудование
Цель реализации балансировки - оптимизация, сокращение времени обслуживания, отказоустойчивость (резервирование)

## Метод балансировки по потокам

Балансировка может быть реализована на некоторых уровнях модели OSI

1) L2 - по MAC-адресу
2) L3 - по IP-адресу (src-dst-ip)
3) L4 - по номеру порта (src-dst-mac)
4) L7- на уровне приложений 

```bush
Switch(config) port-channel load-balance  
dst-ip Dst IP Addr  
dst-macDst Mac Addr  
src-dst-ip Src XOR Dst IP Addr  
src-dst-mac Src XOR Dst Mac Addr  
src-ip Src IP Addr  
src-macSrc Mac Addr  
```



# Протоколы FHRP (HSRP, VRRP, GLBP)

Протоколы семейства FHRP (First Hop Redundancy Protocols) - протоколы резервирования первого хопа. (первый хоп это маршрутизатор, который основной, мы еще его IP прописываем в ОСНОВНОЙ ШЛЮЗ)

Основные термины и определения

1) Виртуальный маршрутизатор (Virtual Router)
2) Активный маршрутизатор (Active Router)
3) Резервный маршрутизатор (Standby Router)
4) ) Группа резервирования (Standby Group)

#### Протокол HSRP

Реализован на 4 уровне модели OSI, для доставки служебной информации используется протокол UDP, использую пакеты приветствия (hello packets)

Настройка
GW1(config-if)#standby 1 ip 192.168.1.1 (ip виртульного шлюза) 
GW1(config-if)#standby 1 priority 200  (номер приоритета)
GW1(config-if)#standby 1 preempt delay 60 (маршрутизатор будет забирать себе роль активного, без него никак, 60 это задержка)
GW1(config-if)#standby 1 authentication md5 XXX (пароль)

#### Протокол VRRP

реализован на 3 уровне модели OSI,  для доставки служебной информации используется  протокол VRRP(номер протокола — 112).  
Маршрутизаторы, на которых включён и настроен  протокол VRRP, для обмена служебной информацией  используют пакеты ADVERTISEMENT (VRRP-  объявление).  
Эти пакеты отправляются на IP-адрес групповой  
рассылки (multicast) 224.0.0.18

В VRRP виртуальным адресом шлюза по умолчанию может быть адрес интерфейса.  
В таком случае маршрутизатору присваивается высший приоритет — 255 (зарезервированное значение),  
и он становится мастером.  
Также за мастером зарезервирован приоритет — 0. Он используется, чтобы сообщить backup-  
маршрутизаторам о сложении с себя ответственности за виртуальный маршрутизатор.  
Диапазон значений 1–254 доступен для backup-маршрутизаторов.  
По умолчанию у всех устройств используется приоритет 100

Настройка 

```bush
GW1(config-if)#vrrp 1 ip 192.168.1.1  
GW1(config-if)#vrrp 1 preempt delay minimum 15  
GW1(config-if)#vrrp 1 authentication md5 XXXXXX
```

```bush
GW2(config-if)#vrrp 1 ip 192.168.1.1  
GW2(config-if)#vrrp 1 preempt delay minimum 15  
GW2(config-if)#vrrp 1 authentication md5 XXXXXX
```

#### Протокол GLBP
 
Настройка 

```bush

R1(config-if)#glbp 1 ip 192.168.0.254  
R1(config-if)#glbp 1 priority 255  
R1(config-if)#glbp 1 preempt delay minimum 15  
R1(config-if)#glbp 1 authentication md5 XXXXXX
```


```bush
R2(config-if)#glbp 1 ip 192.168.0.254  
R2(config-if)#glbp 1 preempt delay minimum 15  
R2(config-if)#glbp 1 authentication md5 XXXXXX
```

```bush
R3(config-if)#glbp 1 ip 192.168.0.254  
R3(config-if)#glbp 1 priority 90  
R3(config-if)#glbp 1 authentication md5 XXXXXX
```



#### StackWise - технология объединения коммутаторов посредством специального кабеля. 

#### VSS(Virtual Swtich System) - технология объединения коммутаторов Catalyst 4500/6500

	VSS объединяет два физических коммутатора в один логический, создавая общий интерфейс управления(Management), используя единый процесс коммутации и маршрутизации для обоих устройств 
	VSS представляет единым логическим устройством для протоколов коммутации и маршрутизации 


#### vPC - технология виртуализации, доступная на коммутаторах Cisco Nexus. Позволяет два коммутатора Nexus объединять в единое логическое L2 - устройство с точки зрения нижестоящих коммутаторов или устройств (серверов)




# **Блок Динамическая Маршрутизация** 

Протоколы динамической маршрутизации строят таблицы маршрутизации автоматически, исходя из текущего состояния сети использованием различных алгоритмов

#### Принцип работы протоколов маршрутизации 

##### 1)  **Этап первый. Старт работы устройств**
		Маршрутизатор ничего не знает ни о соседях, ни о топологии сети. Он знает только ту информацию что записано в конфигурационном файле из NVRAM (Non Volatile Random Access Memory - энергонезависимая память)
		В таблице маршрутизации записываются собственные маршруты к непосредственно присоединенным сетям. Такие сети называют directly connected
##### 2) Этап второй. Установление соседства
		Если настроен протокол маршрутизации, роутер обменивается служебными сообщениями и апдейтами сетей со своими соседями. В апдейтах передаются данные о directly connected сетях. В полученных апдейтах роутер выделяет сети, которых еще нет в таблице, и добавляет их
		На этом этапе узнают о directly connected сетях их непосредственных соседях
##### 3) Этап третий. Поиск удаленных сетей
		Маршрутизаторы обмениваются информацией об удаленных сетях, которые присоединены у удаленным маршрутизаторам, не являющимися их непосредственными соседями
##### 4) Этап четвертый. Сходимость (convergence)
		Convergence или время сходимости - это время, которое требуется маршрутизатором, чтобы обменяться информацией, рассчитать наилучшие пути и обновит свои таблицы маршрутизации
		Сеть считается сошедшейся в момент времени, когда маршрутизаторы:
		1) знают полную и актуальную информацию обо всех доступных сетях
		2) рассчитали лучшие маршруты достижения каждой сети  


> Решением о том, какой путь является к адресу назначения является лучшим, принимается на основании метрик. Метрики разных протоколов нельзя сравнивать между собой!


> Как выбрать лучший маршрут, если разные протоколы маршрутизации на одном устройстве выбрали разные маршруты по разным алгоритмам и метрикам
> Ответ: использовать Administrative distance 


### Administrative distance  (административная дистанция, AD)
AD — это степень доверия маршрутизатора к выбору лучшего маршрута  от разных протоколов. Чем больше административная дистанция, тем меньше  степень доверия  

Автономная система - AS
В общем случае автономная система (домен маршрутизации) - это группа роутеров, находящихся под общим управлением.

Характеристики автономных систем
1) Единая политика маршрутизации
2) Состоит из нескольких префиксов(сетей)
3) Имеют номер(ASN). Номер 2-byte или 4-byte. Номера AS для операторов выделяет местный регулятор. В РФ это RIPE NCC
   
# IGP и EGP - протоколы

Внешние: EGP - Exterlor Gateway Protocol
Внутренние: IGP - Interlor Gateway Protocol (Используется внутри автономной системы. Внутренние протоколы маршрутизации подразделяются на Distance-Vector(RIP, EIGRP) и LINK (OSPF, IS-IS))

# ECMP - протокол

ECMP — это стратегия форвардинга трафика к одной сети  назначения через разные маршруты  с одинаковыми метриками.  Используется эта техника  для балансировки нагрузки между  доступными каналами связи



# Протокол OSPF. Построение соседства, машина состояний, LSDB

Вопрос: виды динамических протоколов маршрутизации. 
Ответ: RIP, EIGRP - дистанционные-векторные, OSPF-протокол link-state

> OSPF(Open Shortest Path First) - протокол динамической маршрутизации, основанный на технологии отслеживания состояния канала(link-state) и использующий для нахождения кратчайшего пути алгоритм Дейкстры.

LSDB (link-state database) - дорожная карта маршрутизатора OSPF:
1) одинаковая на всех маршрутизаторах OSPF в пределах одной зоны
2) состоит из маршрутной информации, составленной при помощи LSA-сообщений 
3) на основании LSDB определяются кратчайшие пути при помощи алгоритма Дейкстры  




 
